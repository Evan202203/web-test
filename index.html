<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幸運抽獎系統</title>
    <!-- 引入 React 和 Tailwind 工具 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 圖示元件 (為了單檔執行，將圖示內建) ---
        const IconBase = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Gift = ({ className }) => <IconBase className={className}><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-8 2.5 2.5 0 0 1 0 5"/></IconBase>;
        const Users = ({ className }) => <IconBase className={className}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
        const Trophy = ({ className }) => <IconBase className={className}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 1 0 5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></IconBase>;
        const Plus = ({ className }) => <IconBase className={className}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>;
        const Trash2 = ({ className }) => <IconBase className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>;
        const Play = ({ className }) => <IconBase className={className}><polygon points="5 3 19 12 5 21 5 3"/></IconBase>;
        const RefreshCw = ({ className }) => <IconBase className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const Download = ({ className }) => <IconBase className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></IconBase>;
        const RotateCcw = ({ className }) => <IconBase className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>;

        // --- 慶祝特效 ---
        const Confetti = ({ isActive }) => {
            const canvasRef = useRef(null);
            useEffect(() => {
                if (!isActive) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let animationFrameId;
                let particles = [];
                const resize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
                window.addEventListener('resize', resize);
                resize();
                const createParticle = () => ({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    size: Math.random() * 10 + 5,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    speedY: Math.random() * 3 + 2,
                    speedX: Math.random() * 2 - 1,
                    rotation: Math.random() * 360,
                    rotationSpeed: Math.random() * 10 - 5
                });
                for (let i = 0; i < 100; i++) { particles.push(createParticle()); }
                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    particles.forEach((p, index) => {
                        p.y += p.speedY; p.x += p.speedX; p.rotation += p.rotationSpeed;
                        ctx.save(); ctx.translate(p.x, p.y); ctx.rotate((p.rotation * Math.PI) / 180);
                        ctx.fillStyle = p.color; ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size); ctx.restore();
                        if (p.y > canvas.height) { particles[index] = createParticle(); particles[index].y = -20; }
                    });
                    animationFrameId = requestAnimationFrame(animate);
                };
                animate();
                return () => { window.removeEventListener('resize', resize); cancelAnimationFrame(animationFrameId); };
            }, [isActive]);
            if (!isActive) return null;
            return <canvas ref={canvasRef} className="fixed inset-0 pointer-events-none z-50" />;
        };
        
        // --- 訊息框元件 ---
        const CustomModal = ({ isVisible, title, message, onConfirm, isConfirm, onClose }) => {
            if (!isVisible) return null;
            
            const handleConfirm = () => {
                if (onConfirm) onConfirm();
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] p-4">
                    <div className="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 transform transition-all duration-300 scale-100">
                        <h3 className={`text-xl font-bold mb-3 ${isConfirm ? 'text-indigo-600' : 'text-red-600'}`}>{title}</h3>
                        <p className="text-slate-600 mb-6">{message}</p>
                        <div className={`flex ${isConfirm ? 'justify-end space-x-3' : 'justify-center'}`}>
                            {isConfirm && (
                                <button onClick={onClose} className="px-4 py-2 text-sm font-medium rounded-lg text-slate-700 bg-slate-100 hover:bg-slate-200 transition-colors">取消</button>
                            )}
                            <button onClick={isConfirm ? handleConfirm : onClose} className={`px-4 py-2 text-sm font-medium rounded-lg text-white transition-colors ${isConfirm ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-green-600 hover:bg-green-700'}`}>
                                {isConfirm ? '確定' : '了解'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 主程式邏輯 ---
        const App = () => {
            const [namesInput, setNamesInput] = useState("田志強\n黃志峰\n蔡榮彬\n張賢業\n林呈光\n陳昱任\n林謙穎");
            const [availableNames, setAvailableNames] = useState([]);
            const [prizes, setPrizes] = useState([
                { id: 1, name: '饗食天堂禮券一張', count: 1, winners: [] }
              
            ]);
            const [currentPrizeId, setCurrentPrizeId] = useState(1);
            const [isRolling, setIsRolling] = useState(false);
            const [displayParticipate, setDisplayParticipate] = useState("準備抽獎");
            const [showConfetti, setShowConfetti] = useState(false);
            // 訊息框狀態
            const [modalState, setModalState] = useState({ isVisible: false, title: '', message: '', onConfirm: null, isConfirm: false });
            
            const closeModal = () => setModalState({ isVisible: false, title: '', message: '', onConfirm: null, isConfirm: false });
            const openAlert = (title, message) => setModalState({ isVisible: true, title, message, onConfirm: null, isConfirm: false });
            const openConfirm = (title, message, onConfirm) => setModalState({ isVisible: true, title, message, onConfirm, isConfirm: true });


            useEffect(() => {
                const names = namesInput.split('\n').map(n => n.trim()).filter(n => n !== '');
                const allWinners = prizes.flatMap(p => p.winners);
                const available = names.filter(n => !allWinners.includes(n));
                setAvailableNames(available);
            }, [namesInput, prizes]);

            const updatePrize = (id, field, value) => {
                setPrizes(prizes.map(p => p.id === id ? { ...p, [field]: value } : p));
            };
            const addPrize = () => {
                const newId = Math.max(...prizes.map(p => p.id), 0) + 1;
                setPrizes([...prizes, { id: newId, name: '新獎項', count: 1, winners: [] }]);
            };
            const removePrize = (id) => {
                setPrizes(prizes.filter(p => p.id !== id));
                if (currentPrizeId === id && prizes.length > 1) {
                    setCurrentPrizeId(prizes.find(p => p.id !== id).id);
                }
            };
            const drawWinner = () => {
                if (availableNames.length === 0) { openAlert("抽獎失敗", "名單已空！請補充人員或重置抽獎。"); return; }
                const currentPrize = prizes.find(p => p.id === currentPrizeId);
                if (currentPrize.winners.length >= currentPrize.count) { openAlert("抽獎失敗", "該獎項名額已滿！請選擇其他獎項或增加名額。"); return; }
                setIsRolling(true); setShowConfetti(false);
                let counter = 0; const maxRolls = 30; const speed = 200;
                const interval = setInterval(() => {
                    const randomIndex = Math.floor(Math.random() * availableNames.length);
                    setDisplayParticipate(availableNames[randomIndex]);
                    counter++;
                    if (counter > maxRolls) { clearInterval(interval); finalizeWinner(availableNames[randomIndex]); }
                }, speed);
            };
            const finalizeWinner = (winner) => {
                setIsRolling(false); setShowConfetti(true);
                setTimeout(() => setShowConfetti(false), 3000);
                setPrizes(prevPrizes => prevPrizes.map(p => {
                    if (p.id === currentPrizeId) { return { ...p, winners: [...p.winners, winner] }; }
                    return p;
                }));
            };
            const resetPrizeWinners = (prizeId) => {
                openConfirm("確認重置", "確定要清空此獎項的得獎者嗎？這些人將回到抽獎池中。", () => {
                    setPrizes(prizes.map(p => p.id === prizeId ? { ...p, winners: [] } : p));
                    closeModal();
                });
            };
            const downloadResults = () => {
                let content = "抽獎結果列表\n----------------\n";
                prizes.forEach(p => {
                    content += `【${p.name}】(共${p.count}名):\n`;
                    if(p.winners.length === 0) content += "  (尚未抽出)\n";
                    p.winners.forEach(w => content += `  - ${w}\n`);
                    content += "\n";
                });
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url; link.download = `抽獎結果_${new Date().toLocaleDateString()}.txt`; link.click();
            };
            const currentPrize = prizes.find(p => p.id === currentPrizeId) || prizes[0];

            return (
                <div className="min-h-screen pb-10">
                    <Confetti isActive={showConfetti} />
                    <header className="bg-indigo-600 text-white p-4 shadow-lg mb-6">
                        <div className="max-w-6xl mx-auto flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <Gift className="w-6 h-6" />
                                <h1 className="text-xl font-bold tracking-wider">幸運抽獎系統</h1>
                            </div>
                            <div className="text-sm bg-indigo-700 px-3 py-1 rounded-full">待抽人數: {availableNames.length}</div>
                        </div>
                    </header>
                    <main className="max-w-6xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
                        <div className="lg:col-span-4 space-y-6">
                            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div className="flex items-center gap-2 mb-3 text-slate-700 font-semibold"><Users className="w-5 h-5" /><h2>人員名單 (一行一個)</h2></div>
                                <textarea value={namesInput} onChange={(e) => setNamesInput(e.target.value)} className="w-full h-40 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-sm font-mono" placeholder="請輸入名字，按下 Enter 換行" />
                            </div>
                            <div className="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                                <div className="flex items-center justify-between mb-3">
                                    <div className="flex items-center gap-2 text-slate-700 font-semibold"><Trophy className="w-5 h-5" /><h2>獎項設定</h2></div>
                                    <button onClick={addPrize} className="text-indigo-600 hover:text-indigo-800 text-sm flex items-center gap-1 font-medium"><Plus className="w-4 h-4" /> 新增</button>
                                </div>
                                <div className="space-y-3 max-h-[300px] overflow-y-auto pr-1">
                                    {prizes.map(prize => (
                                        <div key={prize.id} onClick={() => setCurrentPrizeId(prize.id)} className={`p-3 rounded-lg border flex flex-col gap-2 cursor-pointer ${currentPrizeId === prize.id ? 'border-indigo-500 bg-indigo-50 ring-1 ring-indigo-500' : 'border-slate-200 bg-slate-50'}`}>
                                            <div className="flex items-center justify-between gap-2">
                                                <input type="text" value={prize.name} onChange={(e) => updatePrize(prize.id, 'name', e.target.value)} className="flex-1 bg-transparent font-medium text-slate-800 focus:outline-none focus:border-b border-indigo-400" />
                                                <button onClick={(e) => { e.stopPropagation(); removePrize(prize.id); }} className="text-slate-400 hover:text-red-500 disabled:opacity-30" disabled={prizes.length === 1}><Trash2 className="w-4 h-4" /></button>
                                            </div>
                                            <div className="flex items-center justify-between text-sm">
                                                <div className="flex items-center gap-2"><span className="text-slate-500">名額:</span><input type="number" min="1" value={prize.count} onChange={(e) => updatePrize(prize.id, 'count', parseInt(e.target.value) || 1)} className="w-16 p-1 rounded border border-slate-300 text-center" /></div>
                                                <span className={`text-xs px-2 py-0.5 rounded-full ${prize.winners.length >= prize.count ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>{prize.winners.length} / {prize.count}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                        <div className="lg:col-span-8 flex flex-col gap-6">
                            <div className="bg-white rounded-2xl shadow-md border border-slate-200 overflow-hidden relative">
                                <div className="bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-center text-white">
                                    <h3 className="text-lg opacity-80 mb-1">正在抽取</h3>
                                    <h2 className="text-3xl md:text-4xl font-bold drop-shadow-md">{currentPrize?.name || '請選擇獎項'}</h2>
                                    <p className="mt-2 text-sm opacity-75">剩餘名額: {currentPrize ? Math.max(0, currentPrize.count - currentPrize.winners.length) : 0}</p>
                                </div>
                                <div className="p-10 flex flex-col items-center justify-center min-h-[300px] bg-slate-50">
                                    <div className={`text-5xl md:text-7xl font-bold tracking-widest text-slate-800 transition-all duration-100 py-8 px-12 rounded-2xl bg-white shadow-inner border border-slate-200 ${isRolling ? 'scale-110 text-indigo-600 blur-[0.5px]' : ''}`}>{displayParticipate}</div>
                                    <div className="mt-12 flex gap-4">
                                        <button onClick={drawWinner} disabled={isRolling || !currentPrize || currentPrize.winners.length >= currentPrize.count} className="group relative px-8 py-4 bg-indigo-600 hover:bg-indigo-700 active:bg-indigo-800 text-white rounded-full text-xl font-bold shadow-lg hover:shadow-indigo-500/30 transition-all disabled:opacity-50 disabled:cursor-not-allowed overflow-hidden">
                                            <span className="relative z-10 flex items-center gap-2">{isRolling ? <RefreshCw className="animate-spin w-6 h-6" /> : <Play className="w-6 h-6 fill-current" />}{isRolling ? '抽獎中...' : '開始抽獎'}</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 flex-1">
                                <div className="flex items-center justify-between mb-6 pb-4 border-b border-slate-100">
                                    <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2"><Trophy className="w-6 h-6 text-yellow-500" />中獎名單</h3>
                                    <button onClick={downloadResults} className="text-slate-500 hover:text-indigo-600 flex items-center gap-1 text-sm border px-3 py-1.5 rounded-lg hover:bg-slate-50 transition-colors"><Download className="w-4 h-4" /> 匯出結果</button>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {prizes.map((prize) => (
                                        <div key={prize.id} className="bg-slate-50 rounded-lg p-4 border border-slate-200">
                                            <div className="flex justify-between items-center mb-3">
                                                <h4 className="font-bold text-slate-700">{prize.name}</h4>
                                                <div className="flex items-center gap-2">
                                                    <span className="text-xs text-slate-500">共 {prize.count} 名</span>
                                                    {prize.winners.length > 0 && (<button onClick={() => resetPrizeWinners(prize.id)} title="重置此獎項" className="p-1 hover:bg-red-100 text-slate-400 hover:text-red-500 rounded"><RotateCcw className="w-3.5 h-3.5" /></button>)}
                                                </div>
                                            </div>
                                            {prize.winners.length > 0 ? (<div className="flex flex-wrap gap-2">{prize.winners.map((winner, idx) => (<span key={idx} className="bg-white border border-indigo-100 text-indigo-700 px-3 py-1 rounded-md shadow-sm font-medium animate-fadeIn">{winner}</span>))}</div>) : (<div className="text-slate-400 text-sm italic py-2">尚未抽出</div>)}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </main>
                    <footer className="text-center text-slate-400 text-sm py-6">Designed for Lucky Draws</footer>
                    
                    {/* 訊息框渲染 */}
                    <CustomModal 
                        isVisible={modalState.isVisible} 
                        title={modalState.title} 
                        message={modalState.message} 
                        onConfirm={modalState.onConfirm} 
                        isConfirm={modalState.isConfirm} 
                        onClose={closeModal}
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
@Evan202203
Comment
 
Leave a comment
 
Footer
© 2025 GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
Community
Docs
Contact
Manage cookies
Do not share my personal information
